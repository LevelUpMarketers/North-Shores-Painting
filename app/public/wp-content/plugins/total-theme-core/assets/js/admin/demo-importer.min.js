!function(e,t){"use strict";const o=()=>{let e=!1;document.addEventListener("click",(o=>{if(e)return;const a=o.target.closest(".totaltheme-demo-importer-refresh-btn");if(a){a.disabled=!0,e=!0,document.querySelector(".totaltheme-demo-importer__top").remove(),document.querySelector(".totaltheme-demo-importer-grid").remove(),document.querySelectorAll(".totaltheme-demo-importer-warning").forEach((e=>{e.remove()})),document.querySelector(".totaltheme-demo-importer-refresh-notice").classList.add("totaltheme-demo-importer-refresh-notice--visible");var i=new XMLHttpRequest,r=`action=totaltheme_demo_importer_refresh_list&nonce=${a.dataset.nonce}`;i.onload=function(){var e=JSON.parse(this.responseText);4==i.readyState&&200==i.status?1===e&&location.reload():location.reload()},i.open("POST",t.ajaxurl,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),i.send(r),o.preventDefault()}}))},a={importData:{},isLoadingDemo:!1,allowPopupClosing:!0,init:function(){const o=this;e(".totaltheme-demo-importer__builder-select button").click((function(t){t.preventDefault();const o=e(this).data("value"),a=new URL(window.location.href);a.searchParams.set("builder",o),window.location.href=a.toString()})),e(".totaltheme-demo-importer-grid-item__screenshot").click((function(t){t.preventDefault(),o.isLoadingDemo||(o.isLoadingDemo=!0,e(this).find(".totaltheme-demo-importer-spinner").addClass("wpex-visible-spinner"),o.loadDemo(e(this).parents(".totaltheme-demo-importer-grid-item").attr("data-demo")))})),o.importData={mods:{input_name:"totaltheme_demo_importer_mods_check",preloader:t.strings.importing_mods},widgets:{input_name:"totaltheme_demo_importer_widgets_check",preloader:t.strings.importing_widgets},sliders:{input_name:"totaltheme_demo_importer_sliders_check",preloader:t.strings.importing_sliders},xml:{input_name:"totaltheme_demo_importer_xml_check",preloader:t.strings.importing_xml}},e(".totaltheme-demo-importer-filter__search").on("input",(function(){var t=e(this).val().toLowerCase();e(".totaltheme-demo-importer-grid-item:not(.hidden-by-select)").each((function(){e(this).find(".totaltheme-demo-importer-grid-item__name > span").text().toLowerCase().indexOf(t)>-1?e(this).removeClass("hidden hidden-by-search"):e(this).addClass("hidden hidden-by-search")}))})),e(".totaltheme-demo-importer-filter__categories select").on("change",(function(){const t=e(this).val().toLowerCase();e(".totaltheme-demo-importer-grid-item:not(.hidden-by-search)").each((function(){"all"===t||e(this).data("categories").toLowerCase().indexOf(t)>-1?e(this).removeClass("hidden hidden-by-select"):e(this).addClass("hidden hidden-by-select")}))}));const a=document.querySelector(".totaltheme-demo-importer-filter__clear");a&&a.addEventListener("click",(t=>{e(".totaltheme-demo-importer-grid-item").each((function(){e(this).removeClass("hidden hidden-by-search hidden-by-select")})),e(".totaltheme-demo-importer-filter__categories select").val("all"),e(".totaltheme-demo-importer-filter__builders select").val("all"),e(".totaltheme-demo-importer-filter__search").val("")}))},lightURLParse:function(t){const o=t.split("?")[1].split("&"),a=[];return e.each(o,(function(e,t){const o=t.split("=");a[o[0]]=o[1]})),a},loadDemo:function(o){var a=this;e.ajax({url:t.ajaxurl,type:"get",data:{action:"totaltheme_demo_importer_get_selected",step:"selected",demo:o,nonce:t.nonce},complete:function(t){a.initPopup(t),e(".wpex-visible-spinner").removeClass("wpex-visible-spinner")}})},initPopup:function(o){var a=this;e(o.responseText).appendTo(e(".totaltheme-demo-importer-selected-modal__content")),e(".totaltheme-demo-importer-selected-modal").toggleClass("totaltheme-demo-importer-selected-modal--visible"),e(".totaltheme-demo-importer-selected-next").click((function(t){if(t.preventDefault(),e(this).hasClass("disabled"))return;const o=e(".totaltheme-demo-importer-selected-data");o&&o.remove();const a=e(".totaltheme-demo-importer-selected-form");a&&a.removeClass("hidden")})),e(".totaltheme-demo-importer-selected-modal__close, .totaltheme-demo-importer-abort").click((function(e){e.preventDefault(),a.closePopup()})),e(".totaltheme-demo-importer-selected-modal").click((function(t){e(t.target).hasClass("totaltheme-demo-importer-selected-modal__inner")&&!0===a.allowPopupClosing&&a.closePopup()})),e("#totaltheme_demo_importer_xml_check").change((function(){e(this).is(":checked")?e("#totaltheme_demo_importer_xml_attachments_check").attr({checked:!0}).removeAttr("disabled"):e("#totaltheme_demo_importer_xml_attachments_check").attr({checked:!1,disabled:"disabled"})})),e('.totaltheme-demo-importer-selected-form input[type="checkbox"]').change((function(){let t=!1;e('.totaltheme-demo-importer-selected-form input[type="checkbox"]').each((function(){e(this).is(":checked")&&(t=!0)})),t?e(".totaltheme-demo-importer-selected-confirm").removeAttr("disabled"):e(".totaltheme-demo-importer-selected-confirm").attr("disabled","disabled")})),e(".totaltheme-demo-importer-selected-confirm").click((function(t){!0!==confirm(e(this).attr("data-confirm"))&&t.preventDefault()})),e(".totaltheme-demo-importer-retry-btn").click((function(t){t.preventDefault(),e(".totaltheme-demo-importer-retry-btn").parent().hasClass("hidden")||(e(".totaltheme-demo-importer-selected-status__failed").remove(),e(".totaltheme-demo-importer-selected-form").submit())})),e(".totaltheme-demo-importer-selected-form").submit((function(t){t.preventDefault();const o=[];e(this).find('input[type="checkbox"]').each((function(){!0===e(this).is(":checked")&&o.push(e(this).attr("name"))})),e(".totaltheme-demo-importer-selected-form").addClass("hidden"),e(".totaltheme-demo-importer-selected-loading").removeClass("hidden");const i=e(this).find('input[name="demo"]').val();a.importContent({demo:i,nonce:e(this).find(`input[name="totaltheme_demo_importer_import_${i}_nonce"]`).val(),contentToImport:o,xmlChecked:e("#totaltheme_demo_importer_xml_check").is(":checked")})})),e(".totaltheme-demo-importer-activate-plugin-btn, .totaltheme-demo-importer-install-plugin-btn").click((function(o){if(o.preventDefault(),e(this).hasClass("disabled"))return;const i=e(this),r=i.parents(".totaltheme-demo-importer-selected-plugins__item"),l=a.lightURLParse(i.attr("href")),s=i.parents(".totaltheme-demo-importer-selected-plugins__item").find("td:last-child");let m;"install-plugin"===l.action?m="totaltheme_demo_importer_install_plugin":"activate"===l.action&&(m="totaltheme_demo_importer_activate_plugin"),e(".totaltheme-demo-importer-selected-plugins__item a").addClass("disabled");var n,d=Date.now(),c="",p="install-plugin"===l.action?t.strings.installing_plugin:t.strings.activating_plugin,h=setInterval((function(){s.text(p+c),c=5===c.length?"":c+"."}),200);this.allowPopupClosing=!1;var u=e.ajax({url:t.ajaxurl,type:"post",data:{action:m,nonce:l._wpnonce,plugin_slug:l.plugin},complete:function(o){clearInterval(h),clearTimeout(n),a.allowPopupClosing=!0,"1"===o.responseText?(i.after("<span>"+i.text()+"</span>").remove(),s.empty().html(t.strings.plugin_activated).addClass("totaltheme-plugin-action-result--success"),r.removeClass("totaltheme-demo-importer-selected-plugins__item")):500===o.status?s.empty().text(t.strings.plugin_failed_activation).addClass("totaltheme-plugin-action-result--failed"):void 0!==o.responseText&&-1!==o.responseText.indexOf("target")?s.empty().html(o.responseText).addClass("totaltheme-plugin-action-result--failed"):s.empty().html(t.strings.plugin_failed_activation).addClass("totaltheme-plugin-action-result--failed"),e(".totaltheme-demo-importer-selected-plugins__item .disabled").removeClass("disabled"),0===e(".totaltheme-demo-importer-selected-plugins__item").length&&e(".totaltheme-demo-importer-selected-next").removeClass("disabled");const m="install-plugin"===l.action?"installed":"activated";console.log("The plugin was "+m+" in "+((Date.now()-d)/1e3).toString()+" seconds.")}});"activate"!==l.action&&"install-plugin"!==l.action||(n=setTimeout((function(){u.abort(),a.allowPopupClosing=!0,s.empty().html(t.strings.plugin_failed_activation).addClass("totaltheme-plugin-action-result--failed"),e(".totaltheme-demo-importer-selected-plugins__item .disabled").removeClass("disabled")}),3e4))}))},closePopup:function(){this.isLoadingDemo=!1,e(".totaltheme-demo-importer-selected-modal").removeClass("totaltheme-demo-importer-selected-modal--visible"),e(".totaltheme-demo-importer-selected-modal__content").one("transitionend",(function(){e(".totaltheme-demo-importer-selected-modal__content").empty()}))},importContent:function(o){var a,i,r=this,l=Date.now(),s={demo:o.demo,nonce:o.nonce};if(this.allowPopupClosing=!1,0===o.contentToImport.length)return e(".totaltheme-demo-importer-selected-status").append(`<p class="totaltheme-demo-importer-selected-status__content">${t.strings.finishing_import}</p>`),e.ajax({url:t.ajaxurl,type:"post",data:{action:"totaltheme_demo_importer_step",step:"complete",demo:o.demo,nonce:o.nonce,run_extras:o.xmlChecked},complete:function(t){e(".totaltheme-demo-importer-selected-status__content").addClass("totaltheme-demo-importer-selected-status__complete").removeClass("totaltheme-demo-importer-selected-status__content"),e(".totaltheme-demo-importer-delete-old-data-notice").removeClass("hidden"),e(".totaltheme-demo-importer-selected-loading .totaltheme-demo-importer-selected__warning").addClass("hidden"),e(".totaltheme-demo-importer-retry").addClass("hidden"),e(".totaltheme-demo-importer-selected-complete").removeClass("hidden")}}),void(this.allowPopupClosing=!0);for(var m in this.importData){var n=e.inArray(this.importData[m].input_name,o.contentToImport);if(-1!==n){if(a=m,o.contentToImport.splice(n,1),s.action=this.importData[m].action||"totaltheme_demo_importer_step","totaltheme_demo_importer_step"===s.action&&(s.step=m),"xml"===m){var d=e.inArray("totaltheme_demo_importer_xml_attachments_check",o.contentToImport);-1!==d&&(o.contentToImport.splice(d,1),s.importXML="true")}break}}e(".totaltheme-demo-importer-selected-status").append(`<p class="totaltheme-demo-importer-selected-status__content">${this.importData[a].preloader}</p>`);var c=e.ajax({url:t.ajaxurl,type:"post",data:s,timeout:0,complete:function(s){clearTimeout(i);let m=!0;if(s.status&&console.log("Response status: "+s.status),500===s.status||502===s.status||503===s.status)e(".totaltheme-demo-importer-selected-status__content").addClass("totaltheme-demo-importer-selected-status__failed").removeClass("totaltheme-demo-importer-selected-status__content").text(`${t.strings.content_importing_error} ${s.status}`),m=!1,e(".totaltheme-demo-importer-retry").removeClass("hidden");else if(-1!==s.responseText.indexOf("success"))e(".totaltheme-demo-importer-selected-form").find(`input[name="${r.importData[a].input_name}"]`).attr("checked",!1),e(".totaltheme-demo-importer-selected-status__content").addClass("totaltheme-demo-importer-selected-status__complete").removeClass("totaltheme-demo-importer-selected-status__content");else{const t=e.parseJSON(s.responseText);let o="";for(const e in t)o+=t[e];e(".totaltheme-demo-importer-selected-status__content").addClass("totaltheme-demo-importer-selected-status__failed").removeClass("totaltheme-demo-importer-selected-status__content").text(o),r.allowPopupClosing=!0}!0===m?r.importContent(o):console.error("import aborted due to error"),console.log(r.importData[a].preloader+": "+((Date.now()-l)/1e3).toString()+" seconds.")}});i=setTimeout((function(){c.abort(),r.allowPopupClosing=!0,e(".totaltheme-demo-importer-selected-status__content").addClass("totaltheme-demo-importer-selected-").removeClass("totaltheme-demo-importer-selected-status__content").text(t.content_importing_error)}),15e5)}};e(document).ready((function(){document.addEventListener("click",(o=>{const a=o.target.closest(".totaltheme-demo-importer-remove-old-data-btn");a&&(o.preventDefault(),!0===confirm(a.getAttribute("data-confirm"))&&(document.querySelector(".totaltheme-demo-importer-deleting-data").classList.remove("hidden"),a.classList.add("hidden"),e.ajax({url:t.ajaxurl,type:"get",data:{action:"totaltheme_demo_importer_delete_imported_data",nonce:a.getAttribute("data-nonce")},statusCode:{500:function(){document.querySelector(".totaltheme-demo-importer-deleting-data").classList.add("hidden"),document.querySelector(".totaltheme-demo-importer-deleted-data-error").classList.remove("hidden")}},complete:function(e){let t=e.responseText;try{t=JSON.parse(t)}finally{}"object"==typeof t&&Object.hasOwn(t,"result")&&"success"===t.result?(document.querySelector(".totaltheme-demo-importer-deleting-data").classList.add("hidden"),document.querySelector(".totaltheme-demo-importer-deleted-data-results").classList.remove("hidden"),setTimeout((()=>{document.querySelector(".totaltheme-demo-importer-delete-old-data-notice").classList.add("hidden"),document.querySelector(".totaltheme-demo-importer-remove-old-data-btn").classList.remove("hidden"),document.querySelector(".totaltheme-demo-importer-deleting-data").classList.add("hidden"),document.querySelector(".totaltheme-demo-importer-deleted-data-results").classList.add("hidden")}),1500)):console.error(t)}})))})),o(),a.init()}))}(jQuery,totaltheme_demo_importer_params);