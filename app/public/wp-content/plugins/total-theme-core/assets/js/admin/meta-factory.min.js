window.wpexMetaFactory=window.wpexMetaFactory||{},function(e,t,n){"use strict";e(document).ready((function(){t.init()})),t.init=function(){var n=t.metabox();t.fieldColorPicker(n),t.sortableGroups(n),t.conditionalLogic(),n.on("change",'input[type="text"],input[type="hidden"]',t.handleInputChange),n.on("click",".wpex-mf-help-button",t.handleHelpButtonClick),n.on("keyup",".wpex-mf-help-button",t.handleHelpButtonType),n.on("click",".wpex-mf-upload",t.handleUploadClick),n.on("click",".wpex-mf-upload-remove",t.handleUploadRemove),n.on("click",".wpex-mf-add-group",t.handleAddGroup),n.on("click",".wpex-mf-remove-group",t.removeGroup),n.on("click",".wpex-mf-metabox__tab a",t.handleTabClick),n.on("click",".wpex-mf-metabox__button-group button",t.handleButtonGroupClick),e(document).click(t.onDocClick)},t.metabox=function(){return t.$metabox||(t.$metabox=e(".wpex-mf-metabox")),t.$metabox},t.sortableGroups=function(n){const a=n.find('.wpex-mf-group-set[data-wpex-mf-sortable="1"]');a.length&&a.sortable({connectWith:".wpex-mf-group",handle:".wpex-mf-group-header",cancel:".wpex-mf-group-header-actions",update:function(n,a){const o=e(this).closest(".wpex-mf-group-set");o.find(".wpex-mf-group").each((function(n){e(this).find(".wpex-mf-group-set-index").text(n+1),t.updateIndexes(o)}))}})},t.fieldColorPicker=function(t){"function"==typeof e.fn.wpColorPicker&&e(".wpex-mf-colorpicker",t).wpColorPicker()},t.handleInputChange=function(n){const a=e(this),o=a.closest(".wpex-mf-field--upload");if(o){const e=a.val(),n=o.find(".wpex-mf-upload-preview");e?t.fieldPreviewAJAX(n,e):t.clearPreview(n)}},t.handleHelpButtonClick=function(n){var a=e(this),o=a.attr("aria-expanded"),i=a.parents(".wpex-mf-tr").find("#"+a.attr("aria-controls"));t.hideAllHelpButtons(a),"false"===o?(i.removeAttr("hidden"),a.attr("aria-expanded","true")):(i.attr("hidden",!0),a.attr("aria-expanded","false")),n.preventDefault()},t.handleHelpButtonType=function(t){if("Escape"!==t.key)return;const n=e(this);"true"===n.attr("aria-expanded")&&(n.parents(".wpex-mf-tr").find("#"+n.attr("aria-controls")).attr("hidden",!0),n.attr("aria-expanded","false"))},t.handleUploadClick=function(n){n.preventDefault(),t.fieldUpload(e(this).closest("td").find("input"))},t.handleUploadRemove=function(n){n.preventDefault(),t.clearPreview(e(this).closest("td").find(".wpex-mf-upload-preview"))},t.fieldUpload=function(n){if("undefined"==typeof wp||!wp.media)return;t.mediaFrame&&t.mediaFrame.detach(),e("#wpex-mf-metabox-upload").length&&e("#wpex-mf-metabox-upload").remove();const a={id:"wpex-mf-metabox-upload",frame:"post",state:"insert",filterable:"uploaded",multiple:!1,syncSelection:!1,autoSelect:!0},o=n.closest("td"),i=o.find(".wpex-mf-upload");if(i){let e=i.attr("data-wpex-mf-media-type");e&&"all"!==e&&("font"===e&&(e=["font/woff2","font/woff","application/x-font-woff2","application/x-font-woff"]),a.library={type:e})}t.mediaFrame=wp.media.frames.file_frame=wp.media(a),t.mediaFrame.on("open",(function(){e("#wpex-mf-metabox-upload").addClass("hide-menu")}));const r=o.find(".wpex-mf-upload-preview");t.mediaFrame.on("insert",(function(){const e=t.mediaFrame.state().get("selection").first().toJSON()[n.data("selection")];n.val(e),r.length&&t.fieldPreviewAJAX(r,e)})),t.mediaFrame.open()},t.fieldPreviewAJAX=function(e,t){const a=e.find(".wpex-mf-upload-preview__content");e.addClass("wpex-mf-upload-preview--empty"),a.addClass("hidden"),a.empty();const o=e.find(".wpex-mf-upload-preview__loader");o.show();const i=new XMLHttpRequest,r="action=wpex_mf_field_preview_ajax&field_value="+t+"&nonce="+n.ajax_nonce;i.onload=function(){if(4==i.readyState&&200==i.status){const t=this.responseText;t&&(e.removeClass("wpex-mf-upload-preview--empty"),a.html(t),a.removeClass("hidden"))}else console.log(this.responseText);o.hide()},i.open("POST",window.ajaxurl,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),i.send(r)},t.clearPreview=function(e){e.length&&(e.addClass("wpex-mf-upload-preview--empty"),e.find(".wpex-mf-upload-preview__content").addClass("hidden"),e.closest("td").find("input").val(""))},t.handleAddGroup=function(n){n.preventDefault(),t.addGroup(e(this).closest(".wpex-mf-field--group"))},t.addGroup=function(e){const n=e.find(".wpex-mf-group-template").contents().clone(!0),a=e.find(".wpex-mf-group").length;t.updateGroupIndex(n,a),e.find(".wpex-mf-group-set").append(n),t.setFocus(n),t.conditionalLogic()},t.updateIndexes=function(n){n.find(".wpex-mf-group").each((function(n){t.updateGroupIndex(e(this),n)}))},t.updateGroupIndex=function(t,n){t.find(".wpex-mf-group-set-index").text((n+1).toString());const a=function(e){return e.replace(/-(\d+)-/,"-"+n+"-").replace(/\[(\d+)\]/,"["+n+"]")};t.find("label.wpex-mf-label").each((function(){const t=e(this);t.attr("for",a(t.attr("for")))})),t.find("input, select, textarea").each((function(){const t=e(this);t.attr("id",a(t.attr("id"))),t.attr("name",a(t.attr("name")))})),t.find("tr[id]").each((function(){const t=e(this);t.attr("id",a(t.attr("id")))})),t.find('p[id^="wpex-mf-desc--"]').each((function(){const t=e(this);t.attr("id",a(t.attr("id")))})),t.find("[aria-controls]").each((function(){const t=e(this);t.attr("aria-controls",a(t.attr("aria-controls")))}))},t.removeGroup=function(a){if(a.preventDefault(),confirm(n.delete_group_confirm)){const n=e(this),a=n.closest(".wpex-mf-field--group"),o=e(this).closest(".wpex-mf-group-set"),i=o.find(".wpex-mf-group");n.closest(".wpex-mf-group").remove(),i.length>1?t.updateIndexes(o):t.addGroup(a)}},t.hideAllHelpButtons=function(n){var a=t.metabox().find(".wpex-mf-desc--has-tip");a.length&&a.each((function(){var t=e(this),a=t.parents(".wpex-mf-tr").find(".wpex-mf-help-button");a.not(n)&&(t.attr("hidden",!0),a.attr("aria-expanded","false"))}))},t.onDocClick=function(e){var n=e.target;n.closest(".wpex-mf-desc--has-tip")||n.closest(".wpex-mf-help-button")||t.hideAllHelpButtons()},t.setFocus=function(e){const t=e.find("select, input, textarea, button, a").filter(":visible").first();t.length&&t.focus()},t.handleTabClick=function(t){t.preventDefault();const n=e(this),a=n.parent("li"),o=a.parent("ul"),i=n.attr("aria-controls");o.find("li").each((function(){e(this).removeClass("wp-tab-active"),e(this).find("a").attr("aria-selected","false")})),a.closest(".wpex-mf-metabox").find(".wp-tab-panel").each((function(){i===e(this).attr("id")?e(this).removeClass("hidden"):e(this).addClass("hidden")})),a.addClass("wp-tab-active"),n.attr("aria-selected","true")},t.handleButtonGroupClick=function(t){t.preventDefault();const n=e(this).closest(".wpex-mf-metabox__button-group"),a=e(this).closest("td").find("input"),o=e(this).val()||"";n.find("button").each((function(){e(this).attr("aria-pressed","false")})),e(this).attr("aria-pressed","true"),a.val(o).trigger("change")},t.conditionalLogic=function(){let e=!1;if(!document.querySelector("[data-wpex-mf-condition]"))return;const n=()=>{t.$metabox[0].querySelectorAll("[data-wpex-mf-condition]").forEach((e=>{let t,n=e.getAttribute("data-wpex-mf-condition");try{t=JSON.parse(n)}catch(e){return void console.error("Invalid JSON in data-wpex-mf-condition:",n)}const a=e.closest(".wpex-mf-group");let o=0,i=null;if(a&&(i=a.closest(".wpex-mf-field--group").id.replace("wpex-mf-tr--","")),a){const e=a.closest(".wpex-mf-group-set");if(e){const t=Array.from(e.children).filter((e=>e.classList.contains("wpex-mf-group")));o=t.indexOf(a)}}const r=t.every((([e,t,n])=>{let r=`#wpex-mf-field--${e}`;a&&i&&(r=`#wpex-mf-field--${i}-${o}-${e}`);return((e,t,n)=>{if(!e||e.closest(".hidden"))return!1;let a=e.value;if("checkbox"===e.type&&(a=e.checked.toString()),Array.isArray(n))switch(t){case"=":return n.includes(a);case"!=":return!n.includes(a)}switch(t){case"=":return a==n;case"!=":return a!=n;case">":return parseFloat(a)>parseFloat(n);case"<":return parseFloat(a)<parseFloat(n);case">=":return parseFloat(a)>=parseFloat(n);case"<=":return parseFloat(a)<=parseFloat(n);case"contains":return a.includes(n);case"not_contains":return!a.includes(n);default:return!0}})(document.querySelector(r),t,n)}));e.classList.toggle("hidden",!r),e.querySelectorAll("input, select, textarea").forEach((e=>{r?e.removeAttribute("disabled"):e.setAttribute("disabled","disabled")}))}))};n(),e||(t.$metabox.on("change keyup input","input, select, textarea",n),e=!0)}}(jQuery,window.wpexMetaFactory,totalthemecore_admin_meta_factory_params);